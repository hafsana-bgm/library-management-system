	@{
	ViewData["Title"] = "BookSells";
	Layout = "~/Views/Shared/_AdminLayout.cshtml";
	}

	@model Library_project.DataModel.Member

	<div class="bg-light p-4">

	<div class="container">

	<!-- Customer and Invoice Details -->
	<div class="row g-3 mb-4 my-3">
		<div class="col-md-8">
			<div class="card">
				<div class="card-header bg-info text-white">
					Customer Details
				</div>
				<div class="card-body">
					<div class="mb-3">

						<label>Phone*</label>
							<input type="number" class="form-control" id="MemberPhone"  oninput="phonenumberinput(this)" placeholder="Enter Phone Number">
							<div id="suggestions" style="position:absolute;z-index:1000;background:white;border:1px solid #ccc; display:none;">

							</div>
					</div>
					<div class="mb-3">
						<label>Name</label>
							<input type="text" class="form-control" id="MemberName" oninput="calculate(this)" placeholder="Enter Customer Name">
					</div>
					<div class="mb-3">
						<label>Address</label>
							<input type="text" class="form-control" id="MemberAddress" oninput="calculate(this)" placeholder="Enter Address">
					</div>
						<input name="MemberId" id="MemberId" type="hidden" />
						@* <input name="MemberId" asp-for="MemberId" id="" type="hidden" /> *@
				</div>
			</div>
		</div>


		<div class="col-md-4">
			<div class="card">
				<div class="card-header bg-info text-white">
					Invoice Details
				</div>
				<div class="card-body">
					<div class="mb-3">
						<label>Invoice ID</label>
						<input type="text" class="form-control" value="20250424160042">
					</div>
					<div class="mb-3">
						<label>Printed By</label>
						<input type="text" class="form-control" placeholder="Enter Printer's Name">
					</div>
					<div class="mb-3">
						<label>Date</label>
						<input type="date" class="form-control" value="2025-04-24">
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Invoice Items -->
	<div class="card mb-4 ">
		<div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
			Invoice Items
			<button class="btn btn-danger btn-sm">Add Item</button>
		</div>
		<div class="card-body row g-2">
			<div class="col-md-4">
				<input type="text" class="form-control" placeholder="Add Product Description">
			</div>
			<div class="col-md-2">
				<input type="number" class="form-control" placeholder="Quantity" value="1">
			</div>
			<div class="col-md-2">
				<input type="number" class="form-control" placeholder="Unit Price">
			</div>
			<div class="col-md-2">
				<input type="number" class="form-control" placeholder="Discount %">
			</div>
			<div class="col-md-2">
				<input type="text" class="form-control" value="0" readonly>
			</div>
		</div>
	</div>

	<!-- Order List and Order Summary -->
	<div class="row g-3">
		<div class="col-md-8">
			<div class="card">
				<div class="card-header bg-info text-white">
					Order List
				</div>
				<div class="card-body p-0">
					<table class="table table-striped mb-0">
						<thead class="table-light">
							<tr>
								<th>Product Description</th>
								<th>Quantity</th>
								<th>Price</th>
								<th>Discount</th>
								<th>Total</th>
								<th>Actions</th>
							</tr>
						</thead>
						<tbody>
							<!-- Dynamic rows here -->
						</tbody>
					</table>
				</div>
			</div>
		</div>

		<div class="col-md-4">
			<div class="card">
				<div class="card-header bg-info text-white">
					Order Summary
				</div>
				<div class="card-body">
					<div class="mb-2">
						<label>Subtotal (without Discount):</label>
						<input type="text" class="form-control" value="0.00" readonly>
					</div>
					<div class="mb-2">
						<label>Total Discount:</label>
						<input type="text" class="form-control" value="0.00" readonly>
					</div>
					<div class="mb-2">
						<label>Discount:</label>
						<input type="text" class="form-control" readonly>
					</div>

				</div>
			</div>
		</div>
	</div>

	</div>
	</div>


@section Scripts {
	<script>
		$(document).ready(function () {
			// Debounce function
			function debounce(func, delay) {
				let timeoutId;
				return function (...args) {
					clearTimeout(timeoutId);
					timeoutId = setTimeout(() => func.apply(this, args), delay);
				};
			}

			// Function to populate selected suggestion
			function populateSuggestion(item) {
				$('#MemberId').val(item.id || '0');
				$('#MemberName').val(item.name || '');
				$('#MemberPhone').val(item.phone || '');
				$('#MemberAddress').val(item.address || '');
				$('#suggestions').hide();
			}

			// Fetch phone suggestions
			const fetchPhoneSuggestions = debounce(function (phoneNumber) {
				if (phoneNumber.length < 3) {
					$('#suggestions').hide();
					return;
				}

				$.ajax({
					url: '/BookSell/Phone',
					type: 'GET',
					data: { phone: phoneNumber },
					success: function (data) {
						const suggestionsDiv = $('#suggestions');
						suggestionsDiv.empty().hide();

						if (data.success && data.search && data.search.length) {
							data.search.forEach(function (item) {
								const suggestionItem = $(`
									<div class="suggestion-item"
										 style="padding: 5px; cursor: pointer;"
										 data-id="${item.memberId}"
										 data-name="${item.memberName}"
										 data-phone="${item.memberPhone}"
										 data-address="${item.memberAddress}">
										 ${item.memberName} - ${item.memberPhone}
									</div>
								`);

								suggestionItem.on('click', function () {
									populateSuggestion({
										id: $(this).data('id'),
										name: $(this).data('name'),
										phone: $(this).data('phone'),
										address: $(this).data('address')
									});
								});

								suggestionsDiv.append(suggestionItem);
							});
							suggestionsDiv.show();
						} else {
							suggestionsDiv.append(`<div style="padding: 5px;">No suggestions found</div>`);
							suggestionsDiv.show();
						}
					},
					error: function () {
						console.error('Error fetching phone suggestions.');
						$('#suggestions').hide();
					}
				});
			}, 300); // Debounce delay

			// Attach input event
			$('#MemberPhone').on('input', function () {
				const phoneNumber = $(this).val();
				$('#MemberId').val('0');
				fetchPhoneSuggestions(phoneNumber);
			});

			// Hide suggestions on outside click
			$(document).on('click', function (e) {
				if (!$(e.target).closest('#MemberPhone, #suggestions').length) {
					$('#suggestions').hide();
				}
			});
		});
	</script>


}

